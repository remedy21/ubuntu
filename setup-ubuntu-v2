# 1Ô∏è‚É£ Update & upgrade packages
sudo apt update -y && sudo apt upgrade -y

# 2Ô∏è‚É£ Create required directories
sudo mkdir -p /docker/apps/portainer /docker/storage

# 3Ô∏è‚É£ Install basic dependencies
sudo apt install -y ca-certificates curl gnupg lsb-release

# 4Ô∏è‚É£ Add Docker‚Äôs GPG key
sudo install -m 0755 -d /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo tee /etc/apt/keyrings/docker.asc > /dev/null
sudo chmod a+r /etc/apt/keyrings/docker.asc

# 5Ô∏è‚É£ Add Docker repository
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] \
  https://download.docker.com/linux/ubuntu \
  $(. /etc/os-release && echo \"${UBUNTU_CODENAME:-$VERSION_CODENAME}\") stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# 6Ô∏è‚É£ Update repositories
sudo apt update -y

# 7Ô∏è‚É£ Install Docker Engine & Compose
sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

# 8Ô∏è‚É£ Enable and start Docker
sudo systemctl enable --now docker
docker --version

# 9Ô∏è‚É£ Install Cockpit web management
sudo apt install -y cockpit
sudo systemctl enable --now cockpit.socket

# üîü Allow root SSH login (optional but requested)
sudo sed -i "s/^#\?PermitRootLogin.*/PermitRootLogin yes/" /etc/ssh/sshd_config
sudo systemctl restart ssh

# 1Ô∏è‚É£1Ô∏è‚É£ Deploy Portainer container
sudo docker run -d \
  -p 8000:8000 -p 9443:9443 \
  --name portainer \
  --restart=always \
  -v /var/run/docker.sock:/var/run/docker.sock \
  -v /docker/apps/portainer:/data \
  portainer/portainer-ce:lts

# 1Ô∏è‚É£2Ô∏è‚É£ Verify Portainer is running
sudo docker ps | grep portainer

# 1Ô∏è‚É£3Ô∏è‚É£ Display access info
echo "‚úÖ Setup complete!"
echo "Docker version: $(docker --version)"
echo "Cockpit:   https://$(hostname -I | awk '{print $1}'):9090"
echo "Portainer: https://$(hostname -I | awk '{print $1}'):9443"
